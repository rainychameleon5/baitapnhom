import tkinter as tk
from tkinter import ttk
import matplotlib.pyplot as plt
import pandas as pd

# Đọc dữ liệu từ file CSV
csv_data = pd.read_csv('diemPython.csv')

# Biến toàn cục để lưu loại biểu đồ
chart_type = "line"

# Hàm vẽ biểu đồ dữ liệu của lớp đã chọn dựa trên loại biểu đồ và hiển thị số sinh viên bị điểm F
def plot_grades(selected_class):
    # Lọc dữ liệu theo lớp đã chọn
    selected_data = csv_data[csv_data["Mã lớp"] == selected_class]

    if not selected_data.empty:
        # Lấy dữ liệu điểm theo các loại A+, A, B+, B, C+, C, D+, D, F cho lớp đã chọn
        grades = ["Loại A+", "Loại A", "Loại B+", "Loại B", "Loại C+", "Loại C", "Loại D+", "Loại D", "Loại F"]
        grade_values = [selected_data[grade].values[0] for grade in grades]

        # Vẽ biểu đồ dựa trên loại sơ đồ được chọn
        plt.figure(figsize=(8, 6))
        if chart_type == "line":
            plt.plot(grades, grade_values, marker='o', linestyle='-', color='blue', markersize=8)
            plt.title(f"Phân bố điểm (Sơ đồ đường) của lớp {selected_class}")
        else:
            plt.bar(grades, grade_values, color='blue')
            plt.title(f"Phân bố điểm (Sơ đồ cột) của lớp {selected_class}")

        plt.xlabel("Loại điểm")
        plt.ylabel("Số lượng sinh viên")
        plt.xticks(rotation=45)
        plt.grid(True)
        plt.tight_layout()
        plt.show()



# Hàm hiển thị số sinh viên đạt loại điểm khi chọn radio button
def show_grade_count(selected_class, grade):
    selected_data = csv_data[csv_data["Mã lớp"] == selected_class]

    if not selected_data.empty:
        count = selected_data[grade].values[0]
        listed_f_students.config(state=tk.NORMAL)
        listed_f_students.delete(1.0, tk.END)
        listed_f_students.insert(tk.END, f"Lớp {selected_class} có {count} sinh viên đạt {grade}.")
        listed_f_students.config(state=tk.DISABLED)

# Hàm xử lý sự kiện khi người dùng chọn lớp từ menu
def on_select(event):
    selected_class = class_var.get()

    show_grade_count(selected_class, grade_var.get())

# Hàm chuyển đổi loại biểu đồ
def set_chart_type_to_line():
    global chart_type
    chart_type = "line"
    selected_class = class_var.get()
    plot_grades(selected_class)

def set_chart_type_to_bar():
    global chart_type
    chart_type = "bar"
    selected_class = class_var.get()
    plot_grades(selected_class)

# Tạo cửa sổ chính của giao diện Tkinter
root = tk.Tk()
root.title("Xem điểm")

# Tạo menu thả xuống để chọn lớp
class_var = tk.StringVar()
class_label = ttk.Label(root, text="Chọn lớp:")
class_label.pack(pady=5)

class_dropdown = ttk.Combobox(root, textvariable=class_var)
class_dropdown['values'] = csv_data["Mã lớp"].unique().tolist()
class_dropdown.pack(pady=5)
class_dropdown.bind("<<ComboboxSelected>>", on_select)

# Tạo hai nút để chọn loại biểu đồ
button_frame = ttk.Frame(root)
button_frame.pack(pady=5)

# Nút nhấn để chọn loại biểu đồ là sơ đồ đường
line_button = ttk.Button(button_frame, text="Sơ đồ đường", command=set_chart_type_to_line)
line_button.pack(side=tk.LEFT, padx=5)

# Nút nhấn để chọn loại biểu đồ là sơ đồ cột
bar_button = ttk.Button(button_frame, text="Sơ đồ cột", command=set_chart_type_to_bar)
bar_button.pack(side=tk.LEFT, padx=5)



# Text widget để liệt kê số sinh viên bị điểm F hoặc loại điểm khác
listed_f_students = tk.Text(root, height=2, width=50, state=tk.DISABLED)
listed_f_students.pack(pady=5)

# Tạo các radio button để chọn loại điểm
grade_var = tk.StringVar(value="Loại A+")  # Giá trị mặc định

grades = ["Loại A+", "Loại A", "Loại B+", "Loại B", "Loại C+", "Loại C", "Loại D+", "Loại D", "Loại F"]

# Tạo các radio button và thêm vào giao diện để chọn loại điểm
for grade in grades:
    radio_button = tk.Radiobutton(root, text=grade, variable=grade_var, value=grade, command=lambda: show_grade_count(class_var.get(), grade_var.get()))
    radio_button.pack(anchor=tk.W)

# Chạy vòng lặp sự kiện Tkinter
root.mainloop()
